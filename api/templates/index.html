{% extends "base.html" %}
{% block title %}HexLogic | AT89C51 Simulator{% endblock %}
{% block head %}
<script src="/static/script.js" defer></script>
{% endblock %}
{% block body %}
<div class="ide-root">
    <div class="app-loader" id="app-loader" aria-live="polite">
        <div class="loader-shell">
            <img class="loader-logo" src="/static/hexlogic-logo.png" alt="HexLogic logo"
                onerror="this.onerror=null;this.src='/static/hexlogic-logo-light.png';">
            <div class="loader-bar"><span id="loader-progress"></span></div>
        </div>
    </div>

    <header class="titlebar">
        <div class="title-left">
            <img class="brand-logo" src="/static/hexlogic-logo.png" alt="HexLogic logo"
                onerror="this.onerror=null;this.src='/static/hexlogic-logo-light.png';">
            <div class="brand-meta">
                <span class="brand-name">HexLogic</span>
                <span class="brand-chip">Target: AT89C51</span>
            </div>
        </div>
        <div class="title-right">Cycle Accurate Debug View</div>
    </header>

    <div class="toolbar">
        <div class="toolbar-group">
            <button type="button" class="tool-btn" id="assemble">Assemble</button>
            <button type="button" class="tool-btn" id="run">Run</button>
            <button type="button" class="tool-btn" id="step">Step</button>
            <button type="button" class="tool-btn" id="pause">Pause</button>
            <button type="button" class="tool-btn danger" id="stop">Stop</button>
            <button type="button" class="tool-btn" id="run_to_cursor">Run To Cursor</button>
            <button type="button" class="tool-btn danger" id="reset">Reset</button>
        </div>
        <div class="toolbar-group toolbar-right">
            <label class="toolbar-label" for="run_speed">Speed</label>
            <input id="run_speed" class="speed-input" type="range" min="1" max="10" value="6">
            <span class="speed-label" id="speed_label">6x</span>

            <div class="toolbar-converter">
                <label class="toolbar-label" for="convert_input">Base Converter</label>
                <select id="convert_from" class="converter-select" aria-label="Convert from">
                    <option value="hex">Hex</option>
                    <option value="dec">Dec</option>
                    <option value="bin">Bin</option>
                </select>
                <input class="converter-input" id="convert_input" autocomplete="off" placeholder="Value">
                <span class="converter-arrow">to</span>
                <select id="convert_to" class="converter-select" aria-label="Convert to">
                    <option value="dec">Dec</option>
                    <option value="hex">Hex</option>
                    <option value="bin">Bin</option>
                </select>
                <input class="converter-output" id="convert_output" readonly aria-label="Conversion result">
                <button type="button" class="tool-btn tiny" id="convert_swap">Swap</button>
            </div>

            <button type="button" class="tool-btn small" id="download_output">Download Output</button>
            <button type="button" class="tool-btn small" id="help_toggle" aria-expanded="false"
                aria-controls="help-popover">Help</button>
            <button type="button" class="tool-btn small" id="theme_toggle">Dark Mode</button>
            <button type="button" class="tool-btn small" id="clear_breakpoints">Clear Breakpoints</button>
            <label class="toolbar-label" for="memory_edit_input">Memory Edit</label>
            <input class="memory-edit" placeholder="Ex: 0800H=12H or 20H:2FH" id="memory_edit_input" autocomplete="off">
        </div>
    </div>
    <div class="help-popover" id="help-popover" hidden>
        Help / Contact:
        <a class="help-link" href="mailto:ashwinder.p.prof@gmail.com">ashwinder.p.prof@gmail.com</a>
    </div>

    <main class="workspace" id="workspace">
        <aside class="panel-column left-pane" data-column="left">
            <section class="panel dock-panel target-panel" data-panel="target">
                <div class="panel-title">Target Explorer</div>
                <div class="panel-content">
                    <ul class="project-tree">
                        <li><span class="tree-folder">Target 1 (AT89C51)</span></li>
                        <li><span class="tree-file">startup.a51</span></li>
                        <li><span class="tree-file active">main.asm</span></li>
                        <li><span class="tree-file">sfr_watch</span></li>
                        <li><span class="tree-file">stack_trace</span></li>
                    </ul>
                    <div class="breakpoint-summary">
                        <div class="summary-title">Breakpoints</div>
                        <div id="breakpoint-list" class="summary-body">None</div>
                    </div>
                </div>
            </section>

            <section class="panel dock-panel registers-panel" data-panel="registers" id="registers-flags">
                {% include "render_registers_flags.html" %}
            </section>
        </aside>

        <div class="col-resizer" data-resizer="left" role="separator" aria-orientation="vertical"
            aria-label="Resize left and center panels"></div>

        <section class="panel-column center-pane" data-column="center">
            <section class="panel dock-panel editor-panel" data-panel="editor">
                <div class="panel-title panel-title-row">
                    <span>Editor - main.asm</span>
                    <span class="editor-hint">Click line numbers to toggle breakpoints</span>
                </div>
                <div class="editor-body">
                    <div class="editor-gutter" id="gutter" aria-label="Execution gutter"></div>
                    <textarea class="code-box" id="code" autocomplete="off" spellcheck="false"
                        placeholder="Type 8051 assembly code here"></textarea>
                </div>
            </section>

            <section class="panel dock-panel assembler-panel" data-panel="assembler" id="assembler-container">
                {% include "render_assembler.html" %}
            </section>

            <section class="panel dock-panel debugger-panel" data-panel="debugger">
                <div class="panel-title">Debugger Console</div>
                <div class="debugger-grid">
                    <div id="debug-console" class="debug-console"></div>
                    <div id="error-box" class="error-box" hidden>No errors.</div>
                </div>
            </section>
        </section>

        <div class="col-resizer" data-resizer="right" role="separator" aria-orientation="vertical"
            aria-label="Resize center and right panels"></div>

        <aside class="panel-column right-pane" data-column="right">
            <section class="panel dock-panel memory-panel" data-panel="memory" id="memory-container">
                {% include "render_memory.html" %}
            </section>
        </aside>
    </main>

    <footer class="statusbar">
        <div id="status-text">Ready.</div>
        <div id="status-extra" class="status-right">Mode: AT89C51</div>
    </footer>
</div>
{% endblock %}
